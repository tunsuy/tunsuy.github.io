## 分布式锁
实现分布式锁目前有三种流行方案，分别为基于数据库、Redis、Zookeeper的方案。

### 一、数据库锁
1、	基于数据库的分布式锁  
要实现分布式锁，最简单的方式可能就是直接创建一张锁表，然后通过操作该表中的数据来实现了。  
当我们要锁住某个方法或资源时，我们就在该表中增加一条记录，想要释放锁的时候就删除这条记录。  
该记录表应该是有一个唯一性约束

2、	基于数据库排他锁  
除了可以通过增删操作数据表中的记录以外，其实还可以借助数据中自带的锁来实现分布式的锁  
select * from lock where method_name=xxx for update;

在查询语句后面增加for update，数据库会在查询过程中给数据库表增加排他锁（这里再多提一句，InnoDB引擎在加锁的时候，只有通过索引进行检索的时候才会使用行级锁，否则会使用表级锁。这里我们希望使用行级锁，就要给method_name添加索引，值得注意的是，这个索引一定要创建成唯一索引，否则会出现多个重载方法之间无法同时被访问的问题。重载方法的话建议把参数类型也加上。）。当某条记录被加上排他锁之后，其他线程无法再在该行记录上增加排他锁。

注：  
是否可重入  
是否长时间占用锁，导致连接爆满  
是否有失效时间，一旦解锁失败，将导致死锁  

解：  
增加线程拥有者跟线程的对应关系解决可重入问题  
采用非阻塞获取锁机制，解决长时间占用锁问题  
增加锁的失效时间解决解锁失败问题

## 二、基于缓存实现分布式锁
Redis、memcaches

## 三、基于zookeeper实现分布式锁
待续
